name: Dependencies

on:
  push:

jobs:
  outdated:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.23'

      - name: Install depu
        run: go install github.com/kevwan/depu@latest

      - name: Run depu and capture output
        id: depu
        run: |
          depu >> $GITHUB_OUTPUT
#          depu > outdated.txt
#          cat outdated.txt
#          echo "outdated=$(cat outdated.txt)" >> $GITHUB_ENV

      - name: Post comment with outdated dependencies
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          DEPU: ${{join(steps.run_tests.outputs.*, '\n')}}
        run: |
          echo $DEPU
          gh pr comment --body "### Dependency Check Report\n\`\`\`\n$DEPUd\n\`\`\`"
#          outdated="${{ steps.depu.outputs.outdated }}"
#          outdated=$(echo "$OUTDATED" | base64 --decode)
