name: Deploy backend

inputs:
  aws_access_key_id:
    description: "AWS Access Key ID"
    required: true
  aws_secret_access_key:
    description: "AWS Secret Access Key"
    required: true
  aws_region:
    description: "AWS Region"
    required: true
  aws_ec2_private_key:
    description: "AWS EC2 Private Key"
    required: true

runs:
  using: 'composite'
  steps:
    - name: Set up Go
      uses: actions/setup-go@v5
      with:
        go-version: '1.23'

    - name: Build the app
      shell: bash
      working-directory: ./go
      run: |
        go mod download
        GOOS=linux go build -o bin/app cmd/main.go
#        zip bin.zip cmd/bin

    - name: Deploy to my EC2 instance
      uses: easingthemes/ssh-deploy@v5.1.0
      with:
        REMOTE_HOST: 'ec2-13-41-72-100.eu-west-2.compute.amazonaws.com'
        REMOTE_USER: 'ec2-user'
        SSH_PRIVATE_KEY: ${{ inputs.aws_ec2_private_key }}
        SOURCE: 'go/bin/'
