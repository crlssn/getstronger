name: Deploy web app to S3

inputs:
  aws_access_key_id:
    description: "AWS Access Key ID"
    required: true
  aws_secret_access_key:
    description: "AWS Secret Access Key"
    required: true
  aws_region:
    description: "AWS Region"
    required: true
  aws_ec2_private_key:
    description: "AWS EC2 Private Key"
    required: true

runs:
  using: 'composite'
  steps:
    - name: Set up Go
      uses: actions/setup-go@v5
      with:
        go-version: '1.23'

    - name: Build the app
      shell: bash
      run: |
        go mod download
        go build -o app

#    - name: Deploy to EC2
#      shell: bash
#      env:
#        EC2_HOST: ${{ secrets.EC2_HOST }}
#      run: |
#        chmod 600 ~/.ssh/id_rsa
#        scp -o StrictHostKeyChecking=no -i ~/.ssh/id_rsa ./app ec2-user@$EC2_HOST:~/app
#        ssh -o StrictHostKeyChecking=no -i ~/.ssh/id_rsa ec2-user@$EC2_HOST << EOF
#          pkill app || true
#          nohup ./app &
#        EOF
#
#      # Set up SSH for the EC2 connection
#    - name: Add SSH Key
#      uses: webfactory/ssh-agent@v0.5.3
#      with:
#        ssh-private-key: ${{ inputs.AWS_EC2_PRIVATE_KEY }}